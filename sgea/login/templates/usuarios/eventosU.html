{% extends 'usuarios/base.html' %}
{% load static %}

{% block title %}Eventos Disponíveis - Casa de Atena{% endblock %}

{% block content %} 

{% if messages %}
    <ul class="messages">
        {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}

<div class="eventosDisp-container">
    <div class="eventosDisp-titulo">
        <h1>Eventos disponíveis</h1>
    </div>

    <div class="eventosDisp-quadro">
        <div class="eventos-lista">
            {% for evento in eventos  %}
                {%if not evento.emitido %}
                <div class="eventos-itens">
                    {% if evento.imagem %}
                    <div class="evento-imagem">
                        <img src="{{ evento.imagem.url }}" alt="Imagem do evento {{ evento.nome }}">
                    </div>
                    {% else %}
                    <div>
                        <i>imagem não disponível</i>
                    </div>
                    {% endif %}

                    <h3>{{ evento.nome }}</h3>

                    <div class="evento-botoes">
                        {% if evento.id_evento in inscritos %}
                            <span style="color: green; font-weight: bold;">✅ Já inscrito</span>
                        {% else %}
                            <form method="post" action="{% url 'inscricao_evento' usuario.id_usuario evento.id_evento %}">
                                {% csrf_token %}
                                <button type="submit" class="eventos-inscricao-btn">Inscrever-se</button>
                            </form>
                        {% endif %}
                        <button class="botao-detalhe" data-evento-id="{{ evento.id_evento }}">Ver detalhes</button>
                    </div>

                    <div class="evento-modal" id="modal-{{ evento.id_evento }}">
                        <div class="evento-modal-conteudo">
                            <span class="fechar-modal">&times;</span>
                            <h2>{{ evento.nome }}</h2>
                            {% if evento.imagem %}
                            <div class="evento-imagem">
                                <img src="{{ evento.imagem.url }}" alt="Imagem do evento {{ evento.nome }}">
                            </div>
                            {% else %}
                            <div>
                                <i>imagem não disponível</i>
                            </div>
                            {% endif %}
                            <p><strong>Tipo:</strong> {{ evento.tipoevento }}</p>
                            <p><strong>Local:</strong> {{ evento.local }}</p>
                            <p><strong>Data:</strong> {{ evento.dataI }} até {{ evento.dataF }}</p>
                            <p><strong>Horário:</strong> {{ evento.horarioI }}h às {{ evento.horarioF }}h</p>
                            <p><strong>Vagas disponíveis:</strong> {{ evento.vagas }}</p>
                            <p><strong>Descrição:</strong> {{ evento.descricao }}</p>

                            {% if evento.id_evento in inscritos %}
                                <span style="color: green; font-weight: bold;">✅ Já inscrito</span>
                            {% else %}
                                <form method="post" action="{% url 'inscricao_evento' usuario.id_usuario evento.id_evento %}">
                                    {% csrf_token %}
                                    <button type="submit" class="eventos-inscricao-btn">Inscrever-se</button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
            {% endfor %}        
        </div>
    </div>
</div>
{% endblock %}